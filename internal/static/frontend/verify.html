<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Mail verifizieren - Gassigeher</title>
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body>
    <header>
        <div class="container">
            <a href="/" class="logo">üêï Gassigeher</a>
        </div>
    </header>

    <main style="padding: 60px 0;">
        <div class="container-narrow">
            <div class="card text-center">
                <div id="verification-status">
                    <div class="spinner"></div>
                    <p data-i18n="verification.verifying">Ihre E-Mail-Adresse wird verifiziert...</p>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 Gassigeher. Alle Rechte vorbehalten.</p>
        </div>
    </footer>

    <script src="/js/logo-banner.js"></script>
    <script src="/js/i18n.js"></script>
    <script src="/js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            await window.i18n.load();

            // Get token from URL
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');

            if (!token) {
                showResult(false, 'Kein Verifizierungstoken gefunden.');
                return;
            }

            // Verify email
            try {
                const response = await window.api.verifyEmail(token);

                // Check if WhatsApp group is enabled
                const whatsappData = await window.api.getWhatsAppSettings();
                showResult(true, response.message || window.i18n.t('verification.success_message'), whatsappData);
            } catch (error) {
                showResult(false, error.message || window.i18n.t('verification.error_message'), null);
            }
        });

        function showResult(success, message, whatsappData) {
            const container = document.getElementById('verification-status');
            const icon = success ? '‚úÖ' : '‚ùå';
            const title = success
                ? window.i18n.t('verification.success')
                : window.i18n.t('verification.error');

            let whatsappSection = '';
            if (success && whatsappData && whatsappData.enabled && whatsappData.link) {
                whatsappSection = `
                    <div style="background: #dcf8c6; padding: 20px; border-radius: 8px; margin: 25px 0; border-left: 4px solid #25d366; text-align: left;">
                        <p style="margin: 0 0 15px 0; font-weight: 600; text-align: center;">
                            <span style="font-size: 1.5rem; margin-right: 8px;">üí¨</span>
                            Unserer WhatsApp-Gruppe beitreten
                        </p>
                        <p style="margin: 0 0 15px 0; font-size: 0.9rem; color: #666; text-align: center;">
                            Bleiben Sie auf dem Laufenden und tauschen Sie sich mit anderen Gassigehern aus!
                        </p>
                        <div style="text-align: center;">
                            <a href="${whatsappData.link}" target="_blank" rel="noopener noreferrer"
                               style="display: inline-block; padding: 12px 30px; background-color: #25d366; color: white; text-decoration: none; border-radius: 6px; font-weight: 600;">
                                WhatsApp-Gruppe beitreten
                            </a>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = `
                <h1 style="font-size: 4rem;">${icon}</h1>
                <h2>${title}</h2>
                <p>${message}</p>
                ${whatsappSection}
                ${success ? `
                    <a href="/login.html" class="btn" style="margin-top: 20px;">
                        ${window.i18n.t('verification.go_to_login')}
                    </a>
                ` : `
                    <a href="/" class="btn" style="margin-top: 20px;">
                        ${window.i18n.t('common.back')}
                    </a>
                `}
            `;
        }
    </script>
</body>
</html>
